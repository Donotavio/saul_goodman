<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Saul Goodman - Relatório do dia</title>
    <link rel="icon" type="image/png" href="../img/logotipo_saul_goodman.png" />
    <link rel="stylesheet" href="report.css" />
    <script src="../vendor/chart.umd.js" defer></script>
    <script src="../vendor/jspdf.umd.min.js" defer></script>
    <script type="module" src="../../dist/report/report.js" defer></script>
  </head>
  <body>
    <header class="report-hero">
      <div class="hero-text">
        <span class="tagline">Diário oficial do foco</span>
        <h1>Relatório detalhado</h1>
        <p class="subtitle">Resumo do dia <span id="reportDate">--</span></p>
        <p id="heroMessage" class="hero-message">
          Saul ainda está coletando provas para contar como foi o seu dia.
        </p>
        <div class="hero-metrics">
          <article>
            <span class="label">Índice</span>
            <strong id="heroIndex">--</strong>
          </article>
          <article>
            <span class="label">Foco ativo</span>
            <strong id="heroFocus">--</strong>
          </article>
          <article>
            <span class="label">Trocas de abas</span>
            <strong id="heroSwitches">--</strong>
          </article>
        </div>
      </div>
      <div class="hero-actions">
        <div class="logo-frame">
          <img
            src="../img/logotipo_saul_goodman.png"
            alt="Logotipo Saul Goodman"
            class="logo"
          />
          <span class="logo-caption">Filial digital</span>
        </div>
        <button id="pdfReportButton" class="primary-button">Exportar PDF</button>
        <button id="backButton" class="ghost-button">Voltar ao popup</button>
      </div>
    </header>

    <section id="criticalBanner" class="critical-banner hidden" aria-live="assertive">
      <div class="banner-content">
        <strong>Saul em alerta máximo!</strong>
        <p id="criticalBannerMessage">
          Esse índice está explodindo. Vou precisar de bônus de risco!
        </p>
        <div class="plan-row">
          <p class="plan">
            Plano de ação: feche 3 abas procrastinatórias em
            <span id="criticalBannerCountdown">45</span>s.
          </p>
          <button id="criticalBannerAction" class="ghost-button">Revisar vilões</button>
        </div>
      </div>
    </section>

    <main>
      <section class="panel kpi-panel">
        <div class="panel-header">
          <h2>Indicadores adicionais</h2>
          <p>Ociosidade real, rotas em SPA e tempo de mídia.</p>
        </div>
        <div class="kpi-row">
          <article>
            <span class="label">Mídia em vilões</span>
            <strong id="audioProcrastinationValue">--</strong>
            <small>Tempo com áudio em sites procrastinatórios</small>
          </article>
          <article>
            <span class="label">Navegador fora de foco</span>
            <strong id="unfocusedValue">--</strong>
            <small>Minutos com o browser em segundo plano</small>
          </article>
          <article>
            <span class="label">Rotas em SPA</span>
            <strong id="spaNavigationsValue">--</strong>
            <small>Trocas de rota registradas</small>
          </article>
          <article>
            <span class="label">Tempo em grupos</span>
            <strong id="groupedTimeValue">--</strong>
            <small>Minutos em abas agrupadas</small>
          </article>
          <article>
            <span class="label">Itens fechados hoje</span>
            <strong id="restoredItemsValue">--</strong>
            <small>Abas ou janelas recentes</small>
          </article>
        </div>
      </section>

      <section class="panel">
        <div class="panel-header">
          <h2>Fluxo horário</h2>
          <p>Produtividade versus tentações ao longo do dia.</p>
        </div>
        <div class="chart-wrapper">
          <canvas id="hourlyChart" height="200"></canvas>
          <p id="hourlyEmpty" class="empty-state hidden">
            Ainda não registramos minutos suficientes para montar o fluxo.
          </p>
        </div>
      </section>

      <section class="panel">
        <div class="panel-header">
          <h2>Trocas de abas por hora</h2>
          <p>Como você pulou entre produtivo, procrastinação e neutro ao longo do dia.</p>
        </div>
        <div class="chart-wrapper">
          <canvas id="tabSwitchChart" height="200"></canvas>
          <p id="tabSwitchEmpty" class="empty-state hidden">
            Ainda não registramos trocas suficientes para montar este gráfico.
          </p>
        </div>
      </section>

      <section class="panel duo">
        <div class="panel-block">
          <h2>Composição do dia</h2>
          <canvas id="compositionChart" height="200"></canvas>
        </div>
        <div class="panel-block">
          <h2>Campeões e vilões</h2>
          <ul id="storyList" class="story-list">
            <li>Os dados ainda estão sendo carregados...</li>
          </ul>
        </div>
      </section>

      <section class="panel duo ranking-section">
        <div class="panel-block">
          <h2>Top produtivos</h2>
          <table class="ranking-table" id="productiveRanking">
            <thead>
              <tr>
                <th>Domínio</th>
                <th>Tempo</th>
              </tr>
            </thead>
            <tbody>
              <tr><td colspan="2">Aguardando dados...</td></tr>
            </tbody>
          </table>
        </div>
        <div class="panel-block">
          <h2>Top procrastinação</h2>
          <table class="ranking-table" id="procrastinationRanking">
            <thead>
              <tr>
                <th>Domínio</th>
                <th>Tempo</th>
              </tr>
            </thead>
            <tbody>
              <tr><td colspan="2">Aguardando dados...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <section class="panel timeline-panel">
        <div class="panel-header">
          <h2>Narrativa minuto a minuto</h2>
          <p>Principais trechos que contam a história do seu expediente.</p>
          <div class="timeline-filter">
            <label>
              De
              <input type="number" id="timelineStartHour" min="0" max="23" value="0" />
            </label>
            <label>
              até
              <input type="number" id="timelineEndHour" min="0" max="23" value="23" />
            </label>
            <button type="button" id="timelineFilterButton" class="ghost-button small">
              Filtrar
            </button>
            <button type="button" id="timelineResetButton" class="ghost-button small">
              Resetar
            </button>
          </div>
        </div>
        <ol id="timelineList" class="timeline-list">
          <li>Aguardando registros...</li>
        </ol>
      </section>

      <section class="panel">
        <div class="panel-header">
          <h2>Minutos por domínio</h2>
          <p>Principais campeões e vilões agregados no dia.</p>
        </div>
        <canvas id="domainBreakdownChart" height="220"></canvas>
      </section>

      <section class="panel">
        <div class="panel-header">
          <h2>Argumento do Saul</h2>
          <p>Uma defesa dramática baseada nos seus dados.</p>
        </div>
        <div id="aiNarrative" class="ai-narrative">
          Ainda estou preparando a sustentação oral...
        </div>
        <div class="ai-actions">
          <button id="aiGenerateButton" class="primary-button">Gerar narrativa</button>
          <button id="aiRetryButton" class="ghost-button hidden">Tentar novamente</button>
        </div>
      </section>
    </main>
  </body>
</html>
